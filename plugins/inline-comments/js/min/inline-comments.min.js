!function(n,$,t){var i,e="incom_wrapper",o="#"+e,a="html",r="comments-and-form",c="#"+r,u="incom-commentform",s="data-incom",l=s+"-comment",f=[],d=s+"-bubble",m=s+"-ref",h="incom-active",p="."+h,v="incom-visible-comment",b="."+v,g="incom-position-",y="incom-bubble",w="."+y,k=y+"-style",S=y+"-static",C="."+S,A=y+"-dynamic",T=y+"-active",x=y+"-link",I="incom-comments-wrapper",O="."+I,B="incom-reply",W="."+B,_="incom-cancel",j="."+_,q="incom-info-icon",D="."+q,E="incom-scrolled-to",F=c+" .comment",H="data_incom",N=0,K=$(window).width(),Q,X,Y;n.init=function(n){z(n),G(),J(),qn(),On(),$(W+" .comment-reply-link").on("click",function(){$(c+" #commentform").attr("id",u)}),Wn.init()},n.rebuild=function(){K=$(window).width(),f=[],$("#incom_wrapper .incom-bubble").remove(),J();var n=$(c+":visible");n.length&&(Sn(),Cn("out"))};var z=function(n){i=$.extend({selectors:"p",moveSiteSelector:a,countStatic:!0,alwaysStatic:!1,defaultBubbleText:"+",bubbleStyle:"bubble",bubbleAnimationIn:"default",bubbleAnimationOut:"default",position:"left",background:"white",backgroundOpacity:"1",displayBranding:!1},n)},G=function(){0===$(o).length&&$('<div id="'+e+'"></div>').appendTo($(a)).addClass(g+i.position)},J=function(){$(i.selectors).each(function(){L($(this)),M.createFromElement($(this))})},L=function(n,t){if(t=t||0,!n.attr(s)){var i=P(n);t=R(t,i);var e=i+t;n.attr(s,e)}},M={set:function(n){var i=$.extend({posX:t,posY:t,id:t,visible:!1},n)},createFromElement:function(n){U(n)}},P=function(n){var t=n.prop("tagName").substr(0,5);return t},R=function(n,t){var i=t+n;if(-1!==$.inArray(i,f))for(;-1!==$.inArray(i,f);)n++,i=t+n;return f.push(i),n},U=function(n){var t=V(n),i=nn(n),e=$("<a/>",{href:"","class":x}).text(t).wrap(i).parent().appendTo(o);on(e),hn(n,e),vn(e)?(an(n,e),rn(n,e)):e.hide()},V=function(n){var t;return t=en(n)?Z(n):i.defaultBubbleText},Z=function(n){var t=n.attr(s),i="["+l+"="+t+"]",e=$(i).length;return e+=$(i+" .children li").length},nn=function(n){var t=n.attr(s),i='<div class="'+tn(n)+'" '+d+'="'+t+'" />';return i},tn=function(n){var t=y,e=" ";return(i.alwaysStatic||en(n)&&i.countStatic)&&(t+=e+S),t+=en(n)||!en(n)&&"bubble"===i.bubbleStyle?e+k:e+A},en=function(n){var t=Z(n);return $.isNumeric(t)&&t>0?!0:!1},on=function(n){n.hasClass(S)&&n.css("display","block")},an=function(n,t){t.hasClass(S)||n.add(t).hover(function(){$(w+":not("+C+")").hide(),"fadein"===i.bubbleAnimationIn?t.stop(!0,!0).fadeIn():t.stop(!0,!0).show(),vn(t)||t.hide()},function(){"fadeout"===i.bubbleAnimationOut?t.stop(!0,!0).fadeOut():t.stop(!0,!0).delay(700).hide(0)})},rn=function(n,t){t.on("click",function(i){i.preventDefault(),$(this).hasClass(T)?(Sn(!0),$(this).removeClass(T)):(jn(h),n.addClass(h),Sn(),t.addClass(T),un(t))})},cn=function(){var n;return n=0===$(O).length?$("<div/>",{"class":I}).appendTo(o).css("background-color","rgba("+En(i.background)+","+i.backgroundOpacity+")"):$(O)},un=function(n){var t=cn();dn(),ln(),hn(n,t),bn(t),wn(),sn()},sn=function(){$(document).ready(kn()).ajaxStop(function(){kn()})},ln=function(){$(c).appendTo(O).show(),fn()},fn=function(){var n=$("<input>").attr("type","hidden").attr("name",H).val(mn);$(c+" .form-submit").append($(n))},dn=function(){var n="["+l+"="+mn()+"]";$(F).hide(),$(F+n).addClass(v).show(),$(b+" .children li").show()},mn=function(){var n=$(p).attr(s);return n},hn=function(n,t){var i=n.offset();t.css({top:i.top,left:In()?i.left+n.outerWidth():i.left-t.outerWidth()})},pn=function(n){Q=n.outerWidth(),X=n.offset().left,Y=X+Q},vn=function(n){return pn(n),Y>K||0>X?!1:!0},bn=function(n){pn(n),In()&&Y>K?(gn(Y-K),Cn("in")):!In()&&0>X&&(gn(-X),Cn("in"))},gn=function(n){N=n},yn=function(){return N},wn=function(){$("html").click(function(n){0===$(n.target).parents(o).length&&Sn(!0)})},kn=function(){$(j).click(function(n){n.preventDefault(),Sn(!0)})},Sn=function(n){var t=$(w),i=$(O);$(c).appendTo(o).hide(),$(b).removeClass(v),t.hasClass(T)&&(t.removeClass(T),n?i.fadeOut("fast",function(){$(this).remove(),jn(h)}):i.remove(),Cn("out"))},Cn=function(n){var t=$(i.moveSiteSelector);t.css({position:"relative"}),An(t,n),i.moveSiteSelector!==a&&(xn(n,w),xn(n,O))},An=function(n,t){var i;"in"===t?i=yn():"out"===t&&(i="initial"),Tn(n,i)},Tn=function(n,t){var i=In()?"right":"left",e={};e[i]=t,n.css(e)},xn=function(n,t){var i=$(t);"in"===n?i.css({left:In()?"-="+yn():"+="+yn()}):"out"===n&&i.css({left:In()?"+="+yn():"-="+yn()})},In=function(){return"right"===i.position?!0:!1},On=function(){var n=m,t=s;Bn(n,t),_n(n,t)},Bn=function(n,t){$("["+n+"]").each(function(){var i=$(this),e=i.attr(n),o=$("["+t+'="'+e+'"]');o.length||i.parent().remove()})},Wn={init:function(){this.permalinksHandler()},permalinksHandler:function(){$(c).on("click","a.incom-permalink",function(){var n=$(this.hash);if(n.length){Nn(n);var t=$(this).attr("href");return Hn(t),!1}})}},_n=function(n,t){$("["+n+"]").click(function(){var i=$(this).attr(n),e=$("["+t+'="'+i+'"]');e.length&&(Nn(e),jn(E),e.addClass(E))})},jn=function(n){var t=$("."+n);0!==t.length&&(t.removeClass(n),0===t.prop("class").length&&t.removeAttr("class"))},qn=function(){var n=$(".incom-cancel-x"),t=$(Dn());i.displayBranding!==!0&&1!==i.displayBranding||$(D).length||n.after(t)},Dn=function(){return'<a class="'+q+'" href="http://kevinw.de/inline-comments/" title="Inline Comments by Kevin Weber" target="_blank">i</a>'},En=function(n){var t=parseInt(Fn(n).substring(0,2),16),i=parseInt(Fn(n).substring(2,4),16),e=parseInt(Fn(n).substring(4,6),16);return t+","+i+","+e},Fn=function(n){return"#"===n.charAt(0)?n.substring(1,7):n};$.easing.quart=function(n,t,i,e,o){return-e*((t=t/o-1)*t*t*t-1)+i};var Hn=function(n){history.pushState(null,null,n),history.pushState?history.pushState(null,null,n):location.hash=n},Nn=function(n){var t=$("html, body"),i=n.offset().top-30;t.animate({scrollTop:i},1200,"quart")}}(window.incom=window.incom||{},jQuery);